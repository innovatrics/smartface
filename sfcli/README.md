# sfcli

sfcli is a command-line utility which can be used to interact with SmartFace API.
Exit code of sfcli utility is 0 in case of success and nonzero number in case of any failure.

### Syntax

```
sfcli command [subcommand] [option1, option2, ...]
```

##### Example:
Command "video" with subcommand "get" with no options
```
 sfcli video get 
```

Will list all existing video processors. 

##### Options:
Option are supported in long form prepended by double dash:
```
sfcli video get --streamId 34
```
as well in short form.
```
sfcli video get -s:34
sfcli video get -s=34
sfcli video get -s 34
```

### API destination

##### HTTP

Target HTTP API destination must defined by "--url" option. Value should be address of SmartFace HTTP endpoint with apropriate port.

```sh
$ sfcli --url http://localhost:8099/
```

Example video command with defined url option:

```sh
$ sfcli --url http://localhost:8099/ video get
```

Target instance could be defined also in global variable "sfcli_url"

##### ZeroMQ
Smartface notifications are published via ZeroMQ, sfcli utility uses non configurable default smartface port 2406. 
For more info about notifications please see command "notifications".

### Commands

```
Options:
  -u|--url        SmartFace API Url (e.g. "http://smartfaceserver:8099")
  -?|-h|--help    Show help information

Commands:
  globalconfig    View or edit global smartface settings
  notifications   Receive and print notifications to console
  query           Select entities using Language Integrated Query (LINQ)
  registerWlItem  Create entity
  softRestart     Apply changes
  video           Operations with video
```

#### globalconfig

```
Options:
  -?|-h|--help  Show help information

Commands:
  get           Read properties of GlobalConfig
  set           Edit properties of GlobalConfig
```

##### globalconfig get

Print current config properties.

##### globalconfig set

Change config properties

```
Options:
  -i|--minEyeDistance      Minimum count of pixels between eyes (detection on photo)
  -x|--maxEyeDistance      Maximum count of pixels between eyes (detection on photo)
  -c|--faceConfidence      Face confidence threshold. For cpu detection algorithm around [450]. For gpu algorithm should be set around [8000]
  -a|--detectionAlgorithm  Specify type of algorithm used for face detection. Gpu algorithm is slow if you don't have GPU enabled. [CpuFast, CpuAccurate, Gpu]
  -g|--gpu                 Enable/Disable GPU support. If CPU detection algorithm is used then is GPU card used only for extractions [true, false]
  -?|-h|--help             Show help information

```

#### notifications

Command prints notifications of specific topic provided in option. Requires ctrl+c or new line to exit.

```
Options:
  -t|--topic    Specify topic of notifications [faces.insert, faces.extracted, grouping_progress.info, inputFiles.update, persons.completed, wlHits.match, wlHits.insert]
  -?|-h|--help  Show help information
```

Example:
```sh
$ sfcli --url http://localhost:8099 notifications -t:wlHits.insert
```

#### wlitem

This command mnipulates with wlitems entities.

```
Options:
  -?|-h|--help     Show help information

Commands:
  register         Register single watchlist item
  registerFromDir  Register WlItem entities from photos in directory in format {wlitem_externalId}_*.(jpeg|jpg|png)
```

##### wlitem register

Create or update watchlist item with all required related entities. Unique ExternalIds are supposed to be generated by clients (e.g. GUIDs or external id from another system).

Create :
If ExternalId of watchlist(s) or watchlist item do not exists in database, new ones with provided external id will be created for you automatically.

Replace:
If you want to link watchlist item to other watchlist(s) or change photos of existing watchlist item, use existing external Ids of entities.

NOTE: All watchlist item related data that exists before callling this method will be deleted/unlinked and new one by payload will be recreated.

```
Options:
  -e|--externalId             
  -w|--watchlistsExternalIds  
  -p|--photos <FILE>          
  -?|-h|--help                Show help information
```

Example:
```sh
$ sfcli --url http://localhost:8099 wlitem register -e:external_wlItem_id -w:123 -w:567 -p:face1.jpg -p:face2.jpg
```
This command will create/replace watchlist item with faces from photo files (face1.jpg, face2.jpg) and link this watchlist item to watchlists with external ids (123, 567).

##### wlitem registerFromDir

This command will register multiple wlitems from directory with photos. It will take all image files from given directory which name conforms with format  "{wlitem_externalId}.(jpeg|jpg|png)" and register photos for each externalId as wlitem.
Example file name "ext123.jpeg". 

###### Option --metaDataFile
If you need to fill additional data to wlitem like FullName, DisplayName or Note then use option -m. 
WlItems will be registred from json file which contains array of objects, where each object represents data for wlitem.
This json file is expected to be in specified directory (option --dirToPhotos). Name of json file is irrelevant. 

```
Options:
  -w|--watchlistsExternalIds
  -d|--dirToPhotos
  -m|--metaDataFile           Use this option when you can provide single json file in selected directory with meta data for WlItem. In this case could be use any name for photo file
                              [
                              {
                                  "ExternalId": "120",
                                  "DisplayName": "Display name",
                                  "FullName": "Full name",
                                  "Note": "Example note",
                                  "PhotoFiles": ["file1.jpeg", "file2.jpeg"]
                              }
                              ]

  -?|-h|--help                Show help information
```

Example:
```sh
sfcli --url http://localhost:8099 wlitem registerFromDir -w:fingera -d:"d:\Fingera Registration Photo"
```

#### softrestart

When config values are changed, they are not reflected immediately. To load changed configurations of you need to call softrestart command.

Example:
```sh
$ sfcli --url http://localhost:8099 softrestart
```

#### video

This command allow to create, update or view settings of videoProcessor. VideoProcessor is domain entity which groups some data entities, workers and configs. That alows you to add live stream from IP camera and easily change processing properties.

NOTE: stream id is used as unique identifier of videoProcessor

```
Options:
  -?|-h|--help  Show help information

Commands:
  add           Create new video
  get           Read properties of video
  set           Edit properties of video

```
Example (create videoProcessor):
```sh
$ sfcli --url http://localhost:8099 video add -v:c:\temp\wafs.mp4
```
Example (start videoProcessor):
```sh
$ sfcli --url http://localhost:8099 video set -e:true -s:1
```

##### video add

Create video processor. If scope id is not provided then new scope will be created.

```
Options:
  --scopeId              Scope where stream will be created. If empty, new scope will be created.
  -v|--videoSource       Url to video E.g. rtsp://server.example.org:8080/test.sdp
  -e|--enabled           Whether the stream is processed or not
  -i|--minEyeDistance    Minimum count of pixels between eyes
  -x|--maxEyeDistance    Maximum count of pixels between eyes
  -d|--faceDiscovery     Time between face re-detections in milliseconds
  -p|--mjpegPreviewPort  Port to processed stream MJPEG preview
  -?|-h|--help           Show help information
```

##### video get

Read properties of videoProcessor. If stream id is not provided then all videoProcessors are listed.

```
Options:
  -s|--streamId  Identifier of stream to edit
  -?|-h|--help   Show help information
```

##### video set

Change properties of videoProcessor.

```
Options:
  -s|--streamId          Identifier of stream to edit
  -v|--videoSource       Url to video E.g. rtsp://server.example.org:8080/test.sdp
  -e|--enabled           Whether the stream is processed or not
  -i|--minEyeDistance    Minimum count of pixels between eyes
  -x|--maxEyeDistance    Maximum count of pixels between eyes
  -d|--faceDiscovery     Time between face re-detections in milliseconds
  -p|--mjpegPreviewPort  Port to processed stream MJPEG preview
  -?|-h|--help           Show help information
```